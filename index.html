<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Long Run: A Bayesian Analysis of Lifetime Mileage</title>
    <!-- MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary: #0f172a;
            --accent: #3b82f6;
            --text: #334155;
            --bg: #f1f5f9;
            --card-bg: #ffffff;
            --code-bg: #e2e8f0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.8;
            color: var(--text);
            background-color: var(--bg);
            margin: 0;
            padding: 0;
        }

        header {
            background: var(--primary);
            color: white;
            padding: 100px 20px;
            text-align: center;
        }

        header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            font-weight: 800;
            letter-spacing: -0.04em;
        }

        header .subtitle {
            font-size: 1.5rem;
            opacity: 0.8;
            font-weight: 300;
        }

        main {
            max-width: 850px;
            margin: -50px auto 50px;
            background: var(--card-bg);
            padding: 60px;
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        h2 {
            color: var(--primary);
            margin-top: 4rem;
            font-size: 1.8rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e2e8f0;
        }

        h3 {
            color: #1e293b;
            margin-top: 2.5rem;
            font-size: 1.4rem;
        }

        h4 {
            margin-top: 1.5rem;
            color: var(--accent);
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        p {
            margin-bottom: 1.5rem;
            font-size: 1.125rem;
        }

        .math-block {
            overflow-x: auto;
            padding: 2rem;
            text-align: center;
            background: #f8fafc;
            border-radius: 8px;
            margin: 3rem 0;
            border: 1px solid #e2e8f0;
            font-size: 1.2rem;
        }

        .highlight-box {
            background-color: #eff6ff;
            border-left: 5px solid var(--accent);
            padding: 2rem;
            margin: 3rem 0;
            color: #1e40af;
            border-radius: 0 8px 8px 0;
            font-style: italic;
        }

        figure {
            margin: 4rem 0;
        }

        figure img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        figcaption {
            text-align: center;
            font-size: 0.9rem;
            color: #64748b;
            margin-top: 1rem;
        }

        a {
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Widget Styles */
        .widget-section {
            background: #f8fafc;
            border: 1px solid #cbd5e1;
            border-radius: 12px;
            padding: 3rem;
            margin-top: 5rem;
        }

        .widget-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 700px) {
            .widget-grid {
                grid-template-columns: 1fr;
            }

            main {
                padding: 30px;
                margin-top: 0;
                border-radius: 0;
            }
        }

        label {
            display: block;
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #475569;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        input[type="number"] {
            width: 100%;
            padding: 1rem;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 1.1rem;
            box-sizing: border-box;
        }

        button {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 6px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }

        button:hover {
            background-color: #2563eb;
        }

        .result-display {
            margin-top: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            text-align: center;
            font-size: 1.5rem;
            min-height: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .helper-text {
            display: block;
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 0.25rem;
            font-weight: 400;
            text-transform: none;
        }
    </style>
</head>

<body>

    <header>
        <h1>The Long Run</h1>
        <div class="subtitle">A Hierarchical Bayesian Analysis of Lifetime Mileage</div>
    </header>

    <main>
        <p>In the era of the "Quantified Self," we are obsessed with the granular. Our watches buzz when we hit 10,000
            steps; our apps generate heatmaps of our yearly activity; we chase weekly mileage targets with religious
            fervor. We are masters of the short term.</p>

        <p>But running is fundamentally a long game. It is a habit that, for many, spans decades—from the high school
            track team to the local 5K, and eventually to the Sunday morning shuffle of retirement. Yet, we rarely zoom
            out to the widest possible lens: <strong>The Lifetime Total.</strong></p>

        <p>How many miles does a human being actually run in a lifetime? Is 10,000 miles a lot? Is 100,000 miles even
            physically possible for an amateur? And where do you stand in the global distribution of human movement?</p>

        <p>The answer is surprisingly difficult to find. There is no central database that tracks every human from age
            16 to 80. To answer this, I built a <strong>Hierarchical Bayesian Model</strong> to estimate these
            distributions. By synthesizing global polling data, club records, and survey statistics into a Gaussian
            Mixture Model, we can look past the noisy daily averages and see the clear compounding effect of
            consistency.</p>

        <h2>1. The Conceptual Framework: The Three Tribes</h2>

        <p>If you attempted to calculate the "average lifetime miles" of the global population, the number would be
            statistically meaningless. It would be dragged down by the inactive majority and pulled up by the
            ultra-endurance minority, resulting in a figure that represents nobody.</p>

        <p>To model reality accurately, we must recognize that the population is not uniform. My model posits that
            humanity is divided into three latent groups—or "tribes"—each with distinct behavioral parameters:</p>

        <ul>
            <li><strong>The Non-Runners ($\pi_N \approx 70\%$):</strong> This group represents the structural zero. They
                may walk, cycle, or lift weights, but their contribution to "running mileage" is effectively nil. In the
                model, they are represented by a Dirac Delta function at zero.</li>

            <li><strong>The Casual Runners ($\pi_C \approx 24\%$):</strong> The vast majority of the "active" running
                population. These are the seasonal joggers, the "New Year's Resolution" crowd, and the recreational 5K
                participants. Their volume is generally low, centering around <strong>11 miles per week</strong>
                (~576/year), and their participation is intermittent.</li>

            <li><strong>The Dedicated Runners ($\pi_D \approx 5\%$):</strong> The committed minority. These are the
                individuals for whom running is a "keystone habit." They average <strong>35 miles per week</strong>
                (~1,820/year) and, crucially, they maintain this consistency for decades.</li>
        </ul>

        <h2>2. The Mathematical Model</h2>

        <p>To move from concept to calculation, we need a rigorous statistical framework. We model the probability
            density of Lifetime Miles ($M$) for an individual at age $t$ using a <strong>Gaussian Mixture Model
                (GMM)</strong>.</p>

        <p>The posterior equation is defined as follows:</p>

        <div class="math-block">
            $$ P(M | t) = \underbrace{\pi_{N} \delta(0)}_{\text{Non-Runners}} + \underbrace{\pi_{C} \mathcal{LN}_C +
            \pi_{R} \mathcal{LN}_R + \pi_{D} \mathcal{LN}_D}_{\text{Active Tribes}} $$
            <br>
            <small>Where $\mathcal{LN}_k = \mathcal{LN}(M; \mu_k(t), \sigma_k^2)$</small>
        </div>

        <h3>Deconstructing the Parameters</h3>
        <ul>
            <li><strong>$\pi$ (Weights):</strong> These represent the probability of a random individual belonging to a
                specific group. Through the fitting process (detailed below), these settled at approx. 70%, 24%, and 6%.
            </li>
            <li><strong>$\delta(0)$ (Dirac Delta):</strong> This handles the "Zero Mass." It ensures that the model
                accounts for the fact that a huge portion of the population has 0 lifetime miles.</li>
            <li><strong>$\mathcal{LN}$ (Log-Normal Distribution):</strong> We use Log-Normal rather than Normal
                distributions because mileage is strictly positive and "heavy-tailed." A small number of people run
                <em>orders of magnitude</em> more than the median.
            </li>
            accumulated volume over time. For Dedicated runners, this function grows linearly and aggressively; for
            Casual runners, it grows slowly and often plateaus as they age out of the sport.</li>
            <li><strong>$\tau_{quit}$ (Retention Parameter):</strong> The model now explicitly infers the expected
                "Running Lifespan."
                For Dedicated runners, this is modeled as a Gamma distribution constrained by the "Herron Limit,"
                settling around <strong>30 years</strong> of consistent volume.</li>
        </ul>

        <h3>The Genesis of a Runner (Start Ages)</h3>
        <p>The model also accounts for <em>when</em> people start running. The simulation reveals distinct "genesis"
            patterns:</p>
        <ul>
            <li><strong>Dedicated Runners (Bimodal):</strong> They tend to start in two waves.
                60% are "Lifers" who start young (Age ~16, likely High School track/XC).
                40% are "Adult Onset" runners who discover the sport later (Age ~30), often for health or marathon
                goals.</li>
            <li><strong>Recreational/Casual:</strong> These groups tend to drift into the sport in early adulthood (Age
                24-28), often as a social activity or casual fitness, without the teenage competitive base.</li>
        </ul>

        <p><strong>Reflecting 'Genesis' in the Equation:</strong> Mathematically, the accumulation parameter $\mu(t)$ is
            not a simple coefficient; it is the aggregate of thousands of individual trajectories defined by specific
            start and stop times. For any given individual $i$, their cumulative mileage $M_i(t)$ is a piecewise
            integration:</p>

        <div class="math-block">
            $$ M_i(t) = \sum_{\tau=0}^{t} V_i(\tau) \quad \text{where} \quad V_i(\tau) = \begin{cases}
            0 & \tau < t_{start}^{(i)} \quad (\text{Pre-Genesis}) \\ R_i & t_{start}^{(i)} \le \tau \le t_{quit}^{(i)}
                \quad (\text{Active}) \\ 0 & \tau> t_{quit}^{(i)} \quad (\text{Retention Loss})
                \end{cases} $$
        </div>

        <p>The GMM parameter $\mu_D(t)$ essentially tracks the log-mean of this $M_i(t)$ population. The "Bimodal
            Genesis" of the Dedicated tribe means that for 40% of the group, $V_i(\tau)$ remains zero until $\tau
            \approx 30$, creating the delayed "kink" observed in the variance.</p>

        <h3>Model Inputs (Bayesian Priors)</h3>
        <p>The model uses the following weak priors, allowing the data anchors to drive the posterior distribution:</p>
        <div class="equation" style="text-align: left; padding-left: 2rem;">
            \[
            \begin{aligned}
            \beta_{gender} &\sim \mathcal{N}(0.42, 0.1) \quad (\text{Log-Scale Shift}) \\
            \mu_{casual} &\sim \mathcal{N}(\ln(300), 0.8) \\
            \mu_{rec} &\sim \mathcal{N}(\ln(800), 0.5) \\
            \mu_{ded} &\sim \mathcal{N}(\ln(1400), 0.5) \\
            \sigma_{groups} &\sim \mathcal{HN}(0.5)
            \end{aligned}
            \]
        </div>

        <h2>3. Data Constraints & The "Herron Limit"</h2>

        <p>A Bayesian model is only as good as its priors and constraints. To ensure this simulation reflects reality, I
            did not guess the parameters. I fitted them using a <strong>Hierarchical Loss Function</strong> against
            three specific "anchors" found in recent real-world data.</p>

        <p>I programmed a Python simulation to generate 50,000 synthetic lifetimes, calculated the resulting population
            statistics, and optimized the parameters to minimize the error against these three sources:</p>

        <h4>Anchor A: The Casual Median (Source: Runner's World & Strava)</h4>
        <p>According to the <strong>Runner's World 2023 Survey</strong>, most recreational runners clock between 10 and
            19 miles per week. However, the <strong><a
                    href="https://downloads.ctfassets.net/9olkiac82a1q/iU421iiO6Hky1MVvYThmz/cf2f510407b1b16be35d1c323722f47a/Strava-Global-Report-2023-en-US.pdf">2023
                    & 2024 Strava Year in Sport Reports</a></strong> note that the median run distance is just under 4
            miles, with a median weekly distance around 8.1 miles/week for typical users.
            <br><em>Model Constraint:</em> I penalized the model if the Casual group's median annual volume drifted far
            from the combined estimate of roughly <strong>576 miles/year</strong> (approx 11 mpw).
        </p>

        <h4>Anchor B: The Dedicated Volume (Source: Running USA & Academic Studies)</h4>
        <p>Defining the "Dedicated" runner requires looking at the serious amateur. The <strong><a
                    href="https://www.runningusa.org/running-usa-news/running-usa-releases-2025-global-runner-survey-findings-with-largest-response-ever/">Running
                    USA Global Runner Survey</a></strong> reveals a highly committed demographic. Furthermore, academic
            studies on marathon training (e.g., <em><a
                    href="https://www.dovepress.com/physiological-and-training-characteristics-of-recreational-marathon-ru-peer-reviewed-fulltext-article-OAJSM">Gordon
                    et al., 2017</a></em>) identify a "sweet spot" for serious recreational runners at around <strong>35
                to 50 miles per week</strong>.
            <br><em>Model Constraint:</em> I tuned the Dedicated group parameters ($\mu_D$) to center around
            <strong>1,820
                miles/year</strong> (35 mpw). This separates the "Dedicated" from the "Elite" (who might run 3,000+
            miles)
            and the "Casual."
        </p>

        <h4>Anchor C: The "Herron Limit" (Source: 100k Lifetime Miles Club)</h4>
        <p>This is the most novel constraint in the model. In 2022, ultrarunner <strong>Camille Herron</strong> became
            the youngest person ever inducted into the <strong><a
                    href="https://www.100klifetimemiles.com/p/runners-by-name.html">100,000 Lifetime Miles
                    Club</a></strong> at age 40.</p>
        <p>This provides a powerful statistical boundary (a "Zero Probability Condition"). It implies that the
            probability of a human reaching 100,000 miles <em>before</em> age 40 is vanishingly small. If my model
            predicted that even 0.01% of 40-year-olds had 100k miles, the model would be fundamentally broken.
            <br><em>Model Constraint:</em> I applied a heavy penalty to the loss function if the tail of the
            distribution at Age 40 exceeded 100,000 miles. This "pinched" the variance ($\sigma_D$), ensuring the model
            respects the physiological limits of the human body.
        </p>

        <h3>The Likelihood Function (Bayesian Updating)</h3>
        <p>The magic of the Bayesian approach is estimating latent variables (like the "Gender Gap" or the "Base
            Dedication Level") from disparate, incomplete observations. I constructed the likelihood function to solve
            for these unknowns by essentially "triangulating" the data points:</p>

        <div class="highlight-box">
            <strong>Observation Map:</strong>
            <ul style="list-style-type: none; padding-left: 0;">
                <li>$\mu_{casual} + 0.5\beta_{gender} \sim \mathcal{N}(\text{Strava Mixed Data})$</li>
                <li>$\mu_{rec} \quad \quad \quad \quad \quad \sim \mathcal{N}(\text{Female RunRepeat Avg})$</li>
                <li>$\mu_{ded} + \beta_{gender} \quad \;\; \sim \mathcal{N}(\text{Male Marathoner Avg})$</li>
                <li>$\mu_{ded} + 0.5\beta_{gender} \sim \mathcal{N}(\text{Running USA Core Avg})$</li>
                <li>$\mu_{ded} + \ln(\tau_{quit}) \quad \;\; < \text{Herron Limit (100k)}$</li>
            </ul>
        </div>
        <p>By defining the relationships this way, the model "learned" that Men run ~1.5x more volume than Women (the
            $\beta_{gender}$ term), and that the average "Dedicated Career" lasts approximately 30 years before
            significant volume drop-off.</p>

        <h2>4. Visualizing the Results</h2>

        <h3>1. The Probability Density (PDF)</h3>
        <figure>
            <img src="output_file_pdf_final.png" alt="Distribution of Lifetime Miles for Runners at Age 60">
            <figcaption>Figure 1: The "Valley of Inconsistency" at Age 60. This chart highlights the bimodal nature of
                the running population.
                The green curve (Casual) peaks early at ~<span id="fig1-casual">2,500</span> miles, representing those
                who run sporadically or quit.
                The red curve (Dedicated) pushes far to the right, centered around <span id="fig1-ded">58,000</span>
                miles.
                Note the distinct separation—statistically, it is rare to be a "middle-of-the-road" runner for an entire
                lifetime. You either dabble or you commit.</figcaption>
        </figure>

        <h3>2. The Cumulative Distribution (CDF)</h3>
        <figure>
            <img src="output_file_cdf_final.png" alt="CDF of Lifetime Miles Run by Age">
            <figcaption>Figure 2: Percentile rankings by age. This "S-Curve" shows the massive gap required to reach the
                top percentiles.
                The flat region at the bottom represents the non-runner majority.
                As we move up the y-axis (percentiles), the mileage requirement jumps exponentially.
                To reach the top 1% (Dedicated/Elite) at Age 70, you need nearly 90,000 miles—equivalent to running
                around
                the Earth 3.5 times.</figcaption>
        </figure>

        <h3>3. Median Trajectories</h3>
        <figure>
            <img src="output_file_medians_final.png" alt="Median Lifetime Miles by Age for Each Group">
            <figcaption>Figure 3: The Long-Term Accumulation. This plot reveals how the tribes diverge over time.
                Casual runners (Green) plateau early as they age out of the sport or maintain very low volume.
                Dedicated runners (Red) maintain a linear trajectory, stacking consistent decades of volume.
                The Recreational group (Yellow) sits in the middle, representing the committed hobbyist.</figcaption>
        </figure>

        <p><strong>Key Insight:</strong> The difference between limits is not pace, but persistence. A Dedicated runner
            averaging 10-minute miles will eventually build a statistical tower of volume that dwarfs a faster runner
            who quits after five years.</p>

        <h2>5. Interactive Calculators</h2>

        <p>Based on the fitted parameters from the simulation (Casual $\approx$ 450 miles/yr, Dedicated $\approx$ 2,200
            miles/yr), I have built these calculators to help you estimate your own horizon.</p>

        <div class="widget-section">
            <h3>1. Lifetime Estimator</h3>
            <div class="calculator">
                <h3>Estimator: How many miles have you run?</h3>
                <div class="input-group">
                    <label>Years as Casual Runner (~5-10 mpw):</label>
                    <input type="number" id="casualYears" placeholder="e.g. 5" oninput="calculateTotalMiles()">
                </div>
                <div class="input-group">
                    <label>Years as Recreational Runner (~15-25 mpw):</label>
                    <input type="number" id="recYears" placeholder="e.g. 10" oninput="calculateTotalMiles()">
                </div>
                <div class="input-group">
                    <label>Years as Dedicated Runner (~40+ mpw):</label>
                    <input type="number" id="dedYears" placeholder="e.g. 2" oninput="calculateTotalMiles()">
                </div>
                <div class="result" id="estResult">0 Miles</div>
            </div>
        </div>

        <div class="widget-section">
            <h3>2. Global Percentile Rank</h3>
            <p>Compare your lifetime total against the global population for your age group.</p>

            <div class="widget-grid">
                <div>
                    <label for="userAge">Current Age</label>
                    <span class="helper-text">Between 16 and 80</span>
                    <input type="number" id="userAge" placeholder="30" min="16" max="80">
                </div>
                <div>
                    <label for="userMiles">Total Lifetime Miles</label>
                    <span class="helper-text">Your estimated total</span>
                    <input type="number" id="userMiles" placeholder="1000" min="0">
                </div>
            </div>
            <button onclick="calculatePercentile()">Calculate Percentile</button>
            <div id="percResult" class="result-display">-- th Percentile</div>
            <p id="percContext" style="text-align:center; font-size:1rem; color:#6b7280; margin-top:1rem;"></p>
        </div>

        <h2>6. Conclusion: The Compounding Effect</h2>

        <p>The "Long Run" perspective offers a refreshing antidote to daily performance anxiety. When you view running
            through the lens of a lifetime, speed becomes secondary to longevity.</p>

        <p>The difference between the Casual and Dedicated peaks in the data is not pace; it is persistence. A Dedicated
            runner
            averaging 10-minute miles will eventually build a "statistical tower" of volume that dwarfs a faster runner
            who quits after five years.</p>

        <p>If you are struggling with a slow run or a lack of motivation, remember the data. Every mile deposits into an
            account that compounds over decades. You are not just running for today's workout; you are deciding which
            tribe you belong to.</p>

    </main>

    <script>
        // --- JS LOGIC FOR CALCULATORS ---

        // Fitted Parameters from Hierarchical Optimization
        // Updated with Casual=450/yr and Dedicated=2200/yr targets
        // Structure: Age: { c: [Mean, Std], s: [Mean, Std] }
        const W_NON = 0.60;
        const W_CASUAL = 0.25;
        const W_REC = 0.10;
        const W_DEDICATED = 0.05;

        // Cumulative Mileage Stats (Mean, StdDev) for Active Members of each group at various ages
        // Derived from PyMC/GMM Simulation
        const modelData = {
            16: { c: [439, 182], r: [1178, 523], d: [1737, 335] },
            20: { c: [794, 486], r: [2890, 1718], d: [6622, 2182] },
            30: { c: [1293, 912], r: [6944, 3956], d: [19122, 7399] },
            40: { c: [1977, 1260], r: [14835, 4891], d: [29283, 11429] },
            50: { c: [2434, 1611], r: [22093, 5697], d: [39649, 11698] },
            60: { c: [2558, 1811], r: [26499, 7678], d: [45474, 12889] },
            70: { c: [2583, 1878], r: [28441, 9483], d: [47704, 14474] },
            80: { c: [2586, 1893], r: [29055, 10404], d: [48351, 15438] },
        };
        const WEIGHTS = { non: 0.6, casual: 0.25, rec: 0.1, ded: 0.05 };

        // Generated from Python Script
        const FIG_STATS = {
            age60: { casualMode: 1321, recMode: 27747, dedMode: 45165 }
        };

        function onPageLoad() {
            // Update Figure 1 Caption with Exact Stats
            document.getElementById('fig1-casual').innerText = FIG_STATS.age60.casualMode.toLocaleString();
            document.getElementById('fig1-ded').innerText = FIG_STATS.age60.dedMode.toLocaleString();
        }
        window.onload = onPageLoad;

        // Math Helpers
        function erf(x) {
            var m = 1.00, s = 1.00, sum = x * 1.0;
            for (var i = 1; i < 50; i++) {
                m *= i; s *= -1; sum += (s * Math.pow(x, 2 * i + 1)) / (m * (2 * i + 1));
            }
            return 2 * sum / Math.sqrt(Math.PI);
        }

        function normCDF(x, mean, std) {
            if (std === 0) return x < mean ? 0 : 1;
            return 0.5 * (1 + erf((x - mean) / (Math.sqrt(2) * std)));
        }

        function logNormCDF(x, mean_linear, std_linear) {
            if (x <= 0) return 0;
            // Convert linear mean/std to log-space mu/sigma
            const v = Math.pow(std_linear, 2);
            const m2 = Math.pow(mean_linear, 2);
            const mu_log = Math.log(m2 / Math.sqrt(v + m2));
            const sigma_log = Math.sqrt(Math.log(1 + (v / m2)));

            return normCDF(Math.log(x), mu_log, sigma_log);
        }

        function lerp(start, end, t) {
            return start * (1 - t) + end * t;
        }

        function getParams(age) {
            age = Math.max(16, Math.min(80, age));
            const brackets = [16, 20, 30, 40, 50, 60, 70, 80];
            let lower = 16, upper = 80;

            for (let i = 0; i < brackets.length - 1; i++) {
                if (age >= brackets[i] && age <= brackets[i + 1]) {
                    lower = brackets[i];
                    upper = brackets[i + 1];
                    break;
                }
            }

            if (lower === upper) return modelData[lower];

            const t = (age - lower) / (upper - lower);
            return {
                c: [lerp(modelData[lower].c[0], modelData[upper].c[0], t), lerp(modelData[lower].c[1], modelData[upper].c[1], t)],
                r: [lerp(modelData[lower].r[0], modelData[upper].r[0], t), lerp(modelData[lower].r[1], modelData[upper].r[1], t)],
                d: [lerp(modelData[lower].d[0], modelData[upper].d[0], t), lerp(modelData[lower].d[1], modelData[upper].d[1], t)]
            };
        }

        // Logic
        function calculateTotalMiles() {
            const c = parseFloat(document.getElementById('casualYears').value) || 0;
            const r = parseFloat(document.getElementById('recYears').value) || 0;
            const d = parseFloat(document.getElementById('dedYears').value) || 0;

            // Current Sim "Mixed" Averages approx:
            // Casual: ~250/yr (5 mpw)
            // Rec: ~750/yr (15 mpw)
            // Dedicated: ~2100/yr (40 mpw)

            const total = (c * 250) + (r * 750) + (d * 2100);

            const el = document.getElementById('estResult');
            el.innerText = total.toLocaleString(undefined, { maximumFractionDigits: 0 }) + " Miles";
        }

        function calculatePercentile() {
            const age = parseFloat(document.getElementById('userAge').value);
            const miles = parseFloat(document.getElementById('userMiles').value);

            if (!age || isNaN(miles)) return;

            const p = getParams(age);

            // Calculate CDF for each group
            const cdf_n = (miles > 0) ? 1.0 : 0.0;
            const cdf_c = logNormCDF(miles, p.c[0], p.c[1]);
            const cdf_r = logNormCDF(miles, p.r[0], p.r[1]);
            const cdf_d = logNormCDF(miles, p.d[0], p.d[1]);

            // Weighted Sum (The Mixture)
            const totalProb = (W_NON * cdf_n) + (W_CASUAL * cdf_c) + (W_REC * cdf_r) + (W_DEDICATED * cdf_d);
            const perc = (totalProb * 100);

            let percString = perc.toFixed(1);
            if (perc > 99.9) percString = perc.toFixed(4);

            document.getElementById('percResult').innerText = percString + "th Percentile";

            let ctx = "";
            if (perc < 60) ctx = "You are in the Non-Runner range (The Majority).";
            else if (perc < 85) ctx = "You are in the Casual Runner tier.";
            else if (perc < 95) ctx = "You are in the Recreational Runner tier, consistent and dedicated.";
            else ctx = "You are in the Dedicated Runner tier, truly an outlier.";

            document.getElementById('percContext').innerText = ctx;
        }
    </script>

</body>

</html>