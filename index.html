<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Long Run: A Bayesian Analysis of Lifetime Mileage</title>
    <!-- MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary: #0f172a;
            --accent: #3b82f6;
            --text: #334155;
            --bg: #f1f5f9;
            --card-bg: #ffffff;
            --code-bg: #e2e8f0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.8;
            color: var(--text);
            background-color: var(--bg);
            margin: 0;
            padding: 0;
        }

        header {
            background: var(--primary);
            color: white;
            padding: 100px 20px;
            text-align: center;
        }

        header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            font-weight: 800;
            letter-spacing: -0.04em;
        }

        header .subtitle {
            font-size: 1.5rem;
            opacity: 0.8;
            font-weight: 300;
        }

        main {
            max-width: 850px;
            margin: -50px auto 50px;
            background: var(--card-bg);
            padding: 60px;
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        h2 {
            color: var(--primary);
            margin-top: 4rem;
            font-size: 1.8rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e2e8f0;
        }

        h3 {
            color: #1e293b;
            margin-top: 2.5rem;
            font-size: 1.4rem;
        }

        h4 {
            margin-top: 1.5rem;
            color: var(--accent);
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        p {
            margin-bottom: 1.5rem;
            font-size: 1.125rem;
        }

        .math-block {
            overflow-x: auto;
            padding: 2rem;
            text-align: center;
            background: #f8fafc;
            border-radius: 8px;
            margin: 3rem 0;
            border: 1px solid #e2e8f0;
            font-size: 1.2rem;
        }

        .highlight-box {
            background-color: #eff6ff;
            border-left: 5px solid var(--accent);
            padding: 2rem;
            margin: 3rem 0;
            color: #1e40af;
            border-radius: 0 8px 8px 0;
            font-style: italic;
        }

        figure {
            margin: 4rem 0;
        }

        figure img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        figcaption {
            text-align: center;
            font-size: 0.9rem;
            color: #64748b;
            margin-top: 1rem;
        }

        a {
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Widget Styles */
        .widget-section {
            background: #f8fafc;
            border: 1px solid #cbd5e1;
            border-radius: 12px;
            padding: 3rem;
            margin-top: 5rem;
        }

        .widget-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 700px) {
            .widget-grid {
                grid-template-columns: 1fr;
            }

            main {
                padding: 30px;
                margin-top: 0;
                border-radius: 0;
            }
        }

        label {
            display: block;
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #475569;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        input[type="number"] {
            width: 100%;
            padding: 1rem;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 1.1rem;
            box-sizing: border-box;
        }

        button {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 6px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }

        button:hover {
            background-color: #2563eb;
        }

        .result-display {
            margin-top: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            text-align: center;
            font-size: 1.5rem;
            min-height: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .helper-text {
            display: block;
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 0.25rem;
            font-weight: 400;
            text-transform: none;
        }
    </style>
</head>

<body>

    <header>
        <h1>The Long Run</h1>
        <div class="subtitle">A Hierarchical Bayesian Analysis of Lifetime Mileage</div>
    </header>

    <main>
        <p>Modern run tracking focuses heavily on short-term metrics: weekly volume, annual goals, and pace analysis.
            However, running is a longitudinal activity that often spans decades. This analysis shifts the aperture to
            the widest possible lens: <strong>The Lifetime Total.</strong></p>

        <p>Estimating the distribution of lifetime mileage is challenging due to the lack of longitudinal data spanning
            ages 16 to 80. To address this, I developed a <strong>Hierarchical Bayesian Model</strong>. By synthesizing
            short-term cross-sectional data (Strava, polls) with long-term retention constraints, we can infer the
            hidden distributions of potential human output.</p>

        <h2>1. Conceptual Framework: Latent Sub-Populations</h2>

        <p>A single "average" lifetime mileage figure is statistically meaningless due to the heavy skew of the
            population. Instead, this model defines four latent groups ("components") that comprise the total
            population:</p>

        <ul>
            <li><strong>Non-Runners ($\pi_N \approx 60\%$):</strong> The majority of the population with negligible
                running volume. Modeled as a structural zero ($\delta(0)$).</li>

            <li><strong>Casual Runners ($\pi_C \approx 25\%$):</strong> Seasonal or intermittent participants. Their
                volume typically centers around <strong>~300-500 miles/year</strong> (~6-10 mpw), often plateauing or
                declining after early adulthood.</li>

            <li><strong>Recreational Runners ($\pi_R \approx 10\%$):</strong> Consistent hobbyists. This group averages
                <strong>~800-900 miles/year</strong> (~15-18 mpw), representing the "weekend warrior" or regular social
                runner.
            </li>

            <li><strong>Dedicated Runners ($\pi_D \approx 5\%$):</strong> The committed minority for whom running is a
                primary lifestyle habit. This group averages <strong>~1,800 miles/year</strong> (~35 mpw) and
                maintains consistency over decades, driving the upper tail of the distribution.</li>
        </ul>

        <h2>2. The Mathematical Model</h2>

        <p>To move from concept to calculation, we use a <strong>Hierarchical Bayesian Framework</strong>. We model the
            individual annual volume $V$ as a Log-Normal random variable, conditioned on the latent group assignment $k
            \in \{C, R, D\}$.</p>

        <p>The core philosophy is that "Casual", "Recreational", and "Dedicated" are not arbitrary labels, but distinct
            statistical modes with their own accumulation properties ($k$) and gender-based shifts ($\beta_g$).</p>

        <h3>2.1 Hierarchical Structure</h3>
        <p>The model estimates the log-scale mean $\mu_k$ for each group. We explicitly model a <strong>Gender
                Shift</strong> ($\beta_{gender}$) based on time-use survey data, allowing us to triangulate "Mixed",
            "Male", and "Female" data sources simultaneously.</p>

        <div class="math-block">
            $$ \ln(V_{i}) \sim \mathcal{N}(\mu_{k} + \mathbb{I}_{male} \cdot \beta_{gender}, \sigma_k^2) $$
        </div>

        <p>Where $\mu_k$ is the female baseline for group $k$, and $\beta_{gender}$ represents the log-scale multiplier
            for male volume.</p>

        <h3>2.2 Bayesian Priors</h3>
        <p>We solve for these parameters using <strong>PyMC</strong> (Probabilistic Programming). The following priors
            serve as the "initial guess" before seeing the data:</p>

        <div class="math-block" style="text-align: left; padding-left: 2rem;">
            \[
            \begin{aligned}
            \text{Gender Shift:} & \quad \beta_{gender} \sim \mathcal{N}(\ln(1.53), 0.1) \quad (\text{Source: ATUS
            2024}) \\
            \text{Casual Base:} & \quad \mu_{casual} \sim \mathcal{N}(\ln(300), 0.8) \\
            \text{Rec Base:} & \quad \mu_{rec} \sim \mathcal{N}(\ln(800), 0.5) \\
            \text{Dedicated Base:} & \quad \mu_{ded} \sim \mathcal{N}(\ln(1400), 0.5) \\
            \text{Variability:} & \quad \sigma_{k} \sim \mathcal{HN}(0.5)
            \end{aligned}
            \]
        </div>

        <h3>2.3 Likelihoods (The Data Anchors)</h3>
        <p>The model updates these priors by conditioning on five specific observational anchors (Likelihoods). Each
            anchor constrains the posterior distribution:</p>

        <div class="highlight-box">
            <strong>Observation Map:</strong>
            <ul style="list-style-type: none; padding-left: 0;">
                <li><strong>1. Casual (Mixed):</strong> $\mu_{casual} + 0.5\beta_{gender} \sim \mathcal{N}(\ln(312))$
                    <br> <small><em>Source: Strava Gen Z Median (6 mpw)</em></small>
                </li>
                <li><strong>2. Casual (Mixed):</strong> $\mu_{casual} + 0.5\beta_{gender} \sim \mathcal{N}(\ln(468))$
                    <br> <small><em>Source: Strava Boomer Median (9 mpw)</em></small>
                </li>
                <li><strong>3. Recreational (Female):</strong> $\mu_{rec} \quad \quad \quad \quad \quad \sim
                    \mathcal{N}(\ln(874))$ <br> <small><em>Source: RunRepeat Female Avg (16.8 mpw)</em></small></li>
                <li><strong>4. Dedicated (Male):</strong> $\mu_{ded} + \beta_{gender} \quad \;\; \sim
                    \mathcal{N}(\ln(1924))$ <br> <small><em>Source: Male Marathoner Avg (37 mpw)</em></small></li>
                <li><strong>5. Dedicated (Mixed):</strong> $\mu_{ded} + 0.5\beta_{gender} \sim \mathcal{N}(\ln(1820))$
                    <br> <small><em>Source: Running USA Core Avg (35 mpw)</em></small>
                </li>
            </ul>
        </div>

        <p>Additionally, we apply a <strong>Soft Constraint (Potential)</strong> based on the "Herron Limit": the
            probability of a runner reaching 100,000 miles by age 40 should be negligible ($< 10^{-5}$).</p>

                <h2>3. The Accumulation function $\mu(t)$</h2>
                <p>Lifetime mileage is not a static number; it is a time-series accumulation. To simulate this, we use a
                    <strong>Piecewise Accumulation Function</strong>.
                </p>

                <p>For a simulated individual $i$, the total mileage at age $t$ is the sum of annual volumes
                    $V_i(\tau)$:</p>

                <div class="math-block">
                    $$ M_i(t) = \sum_{\tau=16}^{t} \mathbb{I}_{active}(\tau) \cdot V_i(\tau) $$
                </div>

                <p>The "Active" status is determined by a generated lifecycle:</p>
                <ul>
                    <li><strong>Start Age ($T_{start}$):</strong>
                        <ul>
                            <li>Casual/Rec: Unimodal Normal Distribution (~24-28 years old).</li>
                            <li>Dedicated: <strong>Bimodal Distribution</strong> (~Age 16 for athletes, ~Age 30 for
                                adult onset).</li>
                        </ul>
                    </li>
                    <li><strong>Duration ($\Delta_{active}$):</strong> Modeled as a Gamma Distribution. Dedicated
                        runners have a mean duration of ~30 years, while Casual runners average ~10 years.</li>
                    <li><strong>Intermittency ($p_{active}$):</strong> A Bernoulli coin flip each year to determine if
                        the runner was active that specific year (ranging from 60% consistency for Casual to 95% for
                        Dedicated).</li>
                </ul>

                <h2>4. Visualizing the Results</h2>

                <h3>1. The Probability Density (PDF)</h3>
                <figure>
                    <img src="output_file_pdf_final.png" alt="Distribution of Lifetime Miles for Runners at Age 60">
                    <figcaption>Figure 1: The "Valley of Inconsistency" at Age 60. The distribution is strongly bimodal.
                        The
                        Casual curve (green) peaks at ~<span id="fig1-casual">2,500</span> miles, while the Dedicated
                        curve
                        (red) centers on <span id="fig1-ded">58,000</span> miles. Intermediate volumes are statistically
                        rare.
                    </figcaption>
                </figure>

                <h3>2. The Cumulative Distribution (CDF)</h3>
                <figure>
                    <img src="output_file_cdf_final.png" alt="CDF of Lifetime Miles Run by Age">
                    <figcaption>Figure 2: Percentile rankings by age. This "S-Curve" shows the massive gap required to
                        reach the
                        top percentiles.
                        The flat region at the bottom represents the non-runner majority.
                        As we move up the y-axis (percentiles), the mileage requirement jumps exponentially.
                        To reach the top 1% (Dedicated/Elite) at Age 70, you need nearly 90,000 milesâ€”equivalent to
                        running
                        around
                        the Earth 3.5 times.</figcaption>
                </figure>

                <h3>3. Median Trajectories</h3>
                <figure>
                    <img src="output_file_medians_final.png" alt="Median Lifetime Miles by Age for Each Group">
                    <figcaption>Figure 3: Median Accumulated Volume by Group. This plot reveals how the tribes diverge
                        over time.
                        Casual runners (Green) plateau early as they age out of the sport or maintain very low volume.
                        Dedicated runners (Red) maintain a linear trajectory, stacking consistent decades of volume.
                        The Recreational group (Yellow) sits in the middle, representing the committed hobbyist.
                    </figcaption>
                </figure>

                <h3>4. Consistency of Habit</h3>
                <figure>
                    <img src="output_file_consistency.png"
                        alt="Distribution of Consistency Ratios (Active Years / Career Duration)">
                    <figcaption>Figure 4: Intermittency vs Consistency. The Casual distribution (Green) is broad,
                        showing that
                        many casual runners have significant "gap years". The Dedicated distribution (Red) is clustered
                        tightly
                        at 1.0 (100% active years), illustrating that consistency is the defining trait of the group.
                    </figcaption>
                </figure>

                <p><strong>Key Insight:</strong> The difference between limits is not pace, but persistence. A Dedicated
                    runner
                    averaging 10-minute miles will eventually build a statistical tower of volume that dwarfs a faster
                    runner
                    who quits after five years.</p>

                <h2>5. Inside the Black Box: Model Mechanics</h2>
                <p>To demystify how the model builds these projections, we can peek under the hood at the three internal
                    drivers:</p>

                <h3>1. The "Base Engine": Annual Inputs</h3>
                <figure>
                    <img src="output_file_annual_dist.png" alt="Annual Volume Distributions">
                    <figcaption>Figure 5: The Annual "Brick" distribution. Before accumulation, these are the
                        probabilities of annual volume. Casual runners Center at ~450 miles/year, while Dedicated
                        runners are an order of magnitude higher at ~2,200 miles/year.</figcaption>
                </figure>

                <h3>2. The "Career Arc": Lifecycles</h3>
                <figure>
                    <img src="output_file_gantt.png" alt="Career Gantt Chart of 50 Sample Runners">
                    <figcaption>Figure 6: Lifecycle Gantt Chart (Sample of 50 Active Runners). The horizontal bars
                        represent the active career of a runner. Notice the "Casual" (Green) runners often have short,
                        5-10 year careers, while "Dedicated" (Red) runners maintain the habit for decades.</figcaption>
                </figure>

                <h3>3. The "Persistence Multiplier"</h3>
                <figure>
                    <img src="output_file_scatter.png" alt="Scatter Plot of Active Years vs Total Miles">
                    <figcaption>Figure 7: Persistence vs Volume. Each dot is a simulated life. The relationship is
                        remarkably linear. The "Dedicated" cluster (Red) isn't just higher because they run more per
                        day, but because they run for more <em>years</em>.</figcaption>
                </figure>

                <h2>6. Interactive Calculators</h2>

                <p>Based on the fitted parameters from the simulation (Casual $\approx$ 450 miles/yr, Dedicated
                    $\approx$ 2,200
                    miles/yr), I have built these calculators to help you estimate your own horizon.</p>

                <div class="widget-section">
                    <h3>1. Lifetime Estimator</h3>
                    <div class="calculator">
                        <h3>Estimator: How many miles have you run?</h3>
                        <p style="font-size: 0.9rem; color: #64748b; margin-bottom: 1.5rem;">Sum your active years
                            below. Any years not accounted for are treated as "Non-Runner" years (0 miles).</p>
                        <div class="input-group">
                            <label>Gender Shift:</label>
                            <select id="estGender"
                                style="width: 100%; padding: 1rem; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 1.1rem; background: white;"
                                onchange="calculateTotalMiles()">
                                <option value="mixed">Mixed / Neutral</option>
                                <option value="female">Female</option>
                                <option value="male">Male</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label>Years as Casual Runner (~5-10 mpw):</label>
                            <input type="number" id="casualYears" placeholder="e.g. 5" oninput="calculateTotalMiles()">
                        </div>
                        <div class="input-group">
                            <label>Years as Recreational Runner (~15-25 mpw):</label>
                            <input type="number" id="recYears" placeholder="e.g. 10" oninput="calculateTotalMiles()">
                        </div>
                        <div class="input-group">
                            <label>Years as Dedicated Runner (~40+ mpw):</label>
                            <input type="number" id="dedYears" placeholder="e.g. 2" oninput="calculateTotalMiles()">
                        </div>
                        <div class="result" id="estResult">0 Miles</div>
                    </div>
                </div>

                <div class="widget-section">
                    <h3>2. Global Percentile Rank</h3>
                    <p>Compare your lifetime total against the entire global population for your age group,
                        <strong>including the ~60% of people who are non-runners</strong>.
                    </p>

                    <div class="widget-grid">
                        <div>
                            <label for="userAge">Current Age</label>
                            <span class="helper-text">Between 16 and 80</span>
                            <input type="number" id="userAge" placeholder="30" min="16" max="80">
                        </div>
                        <div>
                            <label for="userGender">Gender</label>
                            <span class="helper-text">Adjusts baseline volume</span>
                            <select id="userGender"
                                style="width: 100%; padding: 1rem; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 1.1rem; background: white;">
                                <option value="mixed">Mixed / Neutral</option>
                                <option value="female">Female</option>
                                <option value="male">Male</option>
                            </select>
                        </div>
                        <div>
                            <label for="userMiles">Total Lifetime Miles</label>
                            <span class="helper-text">Your estimated total</span>
                            <input type="number" id="userMiles" placeholder="1000" min="0">
                        </div>
                    </div>
                    <button onclick="calculatePercentile()">Calculate Percentile</button>
                    <div id="percResult" class="result-display">-- th Percentile</div>
                    <p id="percContext" style="text-align:center; font-size:1rem; color:#6b7280; margin-top:1rem;"></p>
                </div>

                <h2>7. Conclusion</h2>

                <p>The difference between the Casual and Dedicated outcomes is driven less by pace than by persistence.
                    A
                    Dedicated runner averaging 10-minute miles will eventually accumulate a total volume that dwarfs a
                    faster
                    runner with lower consistency.</p>

                <p>While daily metrics are useful for training, the "Long Run" perspective emphasizes the compounding
                    nature of
                    the activity. Whether your lifetime projection is 5,000 or 50,000 miles, the data suggests that
                    longevity is
                    the primary driver of total output.</p>

    </main>

    <script>
        // --- JS LOGIC FOR CALCULATORS ---

        // Fitted Parameters from Hierarchical Optimization
        // Updated with Casual=450/yr and Dedicated=2200/yr targets
        // Structure: Age: { c: [Mean, Std], s: [Mean, Std] }
        const W_NON = 0.60;
        const W_CASUAL = 0.25;
        const W_REC = 0.10;
        const W_DEDICATED = 0.05;

        // Cumulative Mileage Stats (Mean, StdDev) for Active Members of each group at various ages
        // Derived from PyMC/GMM Simulation
        const modelData = {
            16: { c: [442, 187], r: [1187, 532], d: [1736, 339] },
            20: { c: [798, 492], r: [2911, 1734], d: [6618, 2183] },
            30: { c: [1300, 919], r: [6994, 3988], d: [19046, 7493] },
            40: { c: [1986, 1269], r: [14942, 4931], d: [29273, 11484] },
            50: { c: [2445, 1620], r: [22252, 5745], d: [39704, 11718] },
            60: { c: [2570, 1821], r: [26690, 7739], d: [45659, 12967] },
            70: { c: [2595, 1890], r: [28647, 9557], d: [47950, 14588] },
            80: { c: [2598, 1904], r: [29265, 10484], d: [48621, 15585] },
        };
        const WEIGHTS = { non: 0.6, casual: 0.25, rec: 0.1, ded: 0.05 };
        const BETA_GENDER = 0.41; // Log-scale shift derived from PyMC model

        // Generated from Python Script
        const FIG_STATS = {
            age60: { casualMode: 1321, recMode: 27867, dedMode: 43483 }
        };

        function onPageLoad() {
            // Update Figure 1 Caption with Exact Stats
            document.getElementById('fig1-casual').innerText = FIG_STATS.age60.casualMode.toLocaleString();
            document.getElementById('fig1-ded').innerText = FIG_STATS.age60.dedMode.toLocaleString();
        }
        window.onload = onPageLoad;

        // Math Helpers
        function erf(x) {
            var m = 1.00, s = 1.00, sum = x * 1.0;
            for (var i = 1; i < 50; i++) {
                m *= i; s *= -1; sum += (s * Math.pow(x, 2 * i + 1)) / (m * (2 * i + 1));
            }
            return 2 * sum / Math.sqrt(Math.PI);
        }

        function normCDF(x, mean, std) {
            if (std === 0) return x < mean ? 0 : 1;
            return 0.5 * (1 + erf((x - mean) / (Math.sqrt(2) * std)));
        }

        function logNormCDF(x, mean_linear, std_linear) {
            if (x <= 0) return 0;
            // Convert linear mean/std to log-space mu/sigma
            const v = Math.pow(std_linear, 2);
            const m2 = Math.pow(mean_linear, 2);
            const mu_log = Math.log(m2 / Math.sqrt(v + m2));
            const sigma_log = Math.sqrt(Math.log(1 + (v / m2)));

            return normCDF(Math.log(x), mu_log, sigma_log);
        }

        function lerp(start, end, t) {
            return start * (1 - t) + end * t;
        }

        function getParams(age) {
            age = Math.max(16, Math.min(80, age));
            const brackets = [16, 20, 30, 40, 50, 60, 70, 80];
            let lower = 16, upper = 80;

            for (let i = 0; i < brackets.length - 1; i++) {
                if (age >= brackets[i] && age <= brackets[i + 1]) {
                    lower = brackets[i];
                    upper = brackets[i + 1];
                    break;
                }
            }

            if (lower === upper) return modelData[lower];

            const t = (age - lower) / (upper - lower);
            return {
                c: [lerp(modelData[lower].c[0], modelData[upper].c[0], t), lerp(modelData[lower].c[1], modelData[upper].c[1], t)],
                r: [lerp(modelData[lower].r[0], modelData[upper].r[0], t), lerp(modelData[lower].r[1], modelData[upper].r[1], t)],
                d: [lerp(modelData[lower].d[0], modelData[upper].d[0], t), lerp(modelData[lower].d[1], modelData[upper].d[1], t)]
            };
        }

        // Logic
        function calculateTotalMiles() {
            const gender = document.getElementById('estGender').value;
            const c = parseFloat(document.getElementById('casualYears').value) || 0;
            const r = parseFloat(document.getElementById('recYears').value) || 0;
            const d = parseFloat(document.getElementById('dedYears').value) || 0;

            // Current Sim "Mixed" Averages approx:
            // Casual: ~250/yr (5 mpw) -> Adjusted for gender
            // Rec: ~750/yr (15 mpw)
            // Dedicated: ~2100/yr (40 mpw)

            let mult = 1.0;
            if (gender === 'female') mult = Math.exp(-0.5 * BETA_GENDER); // ~0.82
            if (gender === 'male') mult = Math.exp(0.5 * BETA_GENDER);   // ~1.22

            // Base Rates (Mixed)
            const RATE_C = 250;
            const RATE_R = 750;
            const RATE_D = 2100;

            const total = (c * RATE_C * mult) + (r * RATE_R * mult) + (d * RATE_D * mult);

            const el = document.getElementById('estResult');
            el.innerText = total.toLocaleString(undefined, { maximumFractionDigits: 0 }) + " Miles";
        }

        function calculatePercentile() {
            const age = parseFloat(document.getElementById('userAge').value);
            const miles = parseFloat(document.getElementById('userMiles').value);

            if (!age || isNaN(miles)) return;

            const p = getParams(age);
            const gender = document.getElementById('userGender').value;

            // Adjust Means based on Gender
            // Model Data is "Mixed" (Base + 0.5 Beta)
            // Female = Mixed - 0.5 Beta
            // Male = Mixed + 0.5 Beta
            let shift = 0;
            if (gender === 'female') shift = -0.5 * BETA_GENDER;
            if (gender === 'male') shift = 0.5 * BETA_GENDER;

            // Calculate CDF for each group
            const cdf_n = (miles > 0) ? 1.0 : 0.0;
            const cdf_c = logNormCDF(miles, p.c[0] + shift, p.c[1]);
            const cdf_r = logNormCDF(miles, p.r[0] + shift, p.r[1]);
            const cdf_d = logNormCDF(miles, p.d[0] + shift, p.d[1]);

            // Weighted Sum (The Mixture)
            const totalProb = (W_NON * cdf_n) + (W_CASUAL * cdf_c) + (W_REC * cdf_r) + (W_DEDICATED * cdf_d);
            const perc = (totalProb * 100);

            let percString = perc.toFixed(1);
            if (perc > 99.9) percString = perc.toFixed(4);

            document.getElementById('percResult').innerText = percString + "th Percentile";

            let ctx = "";
            if (perc < 60) ctx = "You are in the Non-Runner range (The Majority).";
            else if (perc < 85) ctx = "You are in the Casual Runner tier.";
            else if (perc < 95) ctx = "You are in the Recreational Runner tier, consistent and dedicated.";
            else ctx = "You are in the Dedicated Runner tier, truly an outlier.";

            document.getElementById('percContext').innerText = ctx;
        }
    </script>

</body>

</html>