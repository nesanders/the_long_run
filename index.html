<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Long Run: A Bayesian Analysis of Lifetime Mileage</title>
    <!-- MathJax for LaTeX rendering -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root {
            --primary: #0f172a;
            --accent: #3b82f6;
            --text: #334155;
            --bg: #f1f5f9;
            --card-bg: #ffffff;
            --code-bg: #e2e8f0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            line-height: 1.8;
            color: var(--text);
            background-color: var(--bg);
            margin: 0;
            padding: 0;
        }

        header {
            background: var(--primary);
            color: white;
            padding: 100px 20px;
            text-align: center;
        }

        header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            font-weight: 800;
            letter-spacing: -0.04em;
        }

        header .subtitle {
            font-size: 1.5rem;
            opacity: 0.8;
            font-weight: 300;
        }

        main {
            max-width: 850px;
            margin: -50px auto 50px;
            background: var(--card-bg);
            padding: 60px;
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        h2 {
            color: var(--primary);
            margin-top: 4rem;
            font-size: 1.8rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e2e8f0;
        }

        h3 {
            color: #1e293b;
            margin-top: 2.5rem;
            font-size: 1.4rem;
        }

        h4 {
            margin-top: 1.5rem;
            color: var(--accent);
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        p {
            margin-bottom: 1.5rem;
            font-size: 1.125rem;
        }

        .math-block {
            overflow-x: auto;
            padding: 2rem;
            text-align: center;
            background: #f8fafc;
            border-radius: 8px;
            margin: 3rem 0;
            border: 1px solid #e2e8f0;
            font-size: 1.2rem;
        }

        .highlight-box {
            background-color: #eff6ff;
            border-left: 5px solid var(--accent);
            padding: 2rem;
            margin: 3rem 0;
            color: #1e40af;
            border-radius: 0 8px 8px 0;
            font-style: italic;
        }

        figure {
            margin: 4rem 0;
        }

        figure img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        figcaption {
            text-align: center;
            font-size: 0.9rem;
            color: #64748b;
            margin-top: 1rem;
        }

        a {
            color: var(--accent);
            text-decoration: none;
            font-weight: 600;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Widget Styles */
        .widget-section {
            background: #f8fafc;
            border: 1px solid #cbd5e1;
            border-radius: 12px;
            padding: 3rem;
            margin-top: 5rem;
        }

        .widget-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 700px) {
            .widget-grid {
                grid-template-columns: 1fr;
            }

            main {
                padding: 30px;
                margin-top: 0;
                border-radius: 0;
            }
        }

        label {
            display: block;
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #475569;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        input[type="number"] {
            width: 100%;
            padding: 1rem;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 1.1rem;
            box-sizing: border-box;
        }

        button {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 6px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            width: 100%;
            transition: background 0.2s;
        }

        button:hover {
            background-color: #2563eb;
        }

        .result-display {
            margin-top: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            text-align: center;
            font-size: 1.5rem;
            min-height: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .helper-text {
            display: block;
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 0.25rem;
            font-weight: 400;
            text-transform: none;
        }
    </style>
</head>

<body>

    <header>
        <h1>The Long Run</h1>
        <div class="subtitle">A Hierarchical Bayesian Analysis of Lifetime Mileage</div>
    </header>

    <main>
        <p>Modern run tracking focuses heavily on short-term metrics: weekly volume, annual goals, and pace analysis.
            However, running is a longitudinal activity that often spans decades. This analysis shifts the aperture to
            the widest possible lens: <strong>The Lifetime Total.</strong></p>

        <p>Estimating the distribution of lifetime mileage is challenging due to the lack of longitudinal data spanning
            ages 16 to 80. To address this, I developed a <strong>Hierarchical Bayesian Model</strong>. By synthesizing
            short-term cross-sectional data (Strava, polls) with long-term retention constraints, we can infer the
            hidden distributions of potential human output.</p>

        <h2>1. Conceptual Framework: Latent Sub-Populations</h2>

        <p>A single "average" lifetime mileage figure is statistically meaningless due to the heavy skew of the
            population. Instead, this model defines four latent groups ("components") that comprise the total
            population:</p>

        <ul>
            <li><strong>Non-Runners ($\pi_N \approx 60\%$):</strong> The majority of the population with negligible
                running volume. Modeled as a structural zero ($\delta(0)$).</li>

            <li><strong>Casual Runners ($\pi_C \approx 25\%$):</strong> Seasonal or intermittent participants. Their
                volume typically centers around <strong>~300-500 miles/year</strong> (~6-10 mpw), often plateauing or
                declining after early adulthood.</li>

            <li><strong>Recreational Runners ($\pi_R \approx 10\%$):</strong> Consistent hobbyists. This group averages
                <strong>~800-900 miles/year</strong> (~15-18 mpw), representing the "weekend warrior" or regular social
                runner.
            </li>

            <li><strong>Dedicated Runners ($\pi_D \approx 5\%$):</strong> The committed minority for whom running is a
                primary lifestyle habit. This group averages <strong>~1,500-2,000 miles/year</strong> (~30-40 mpw) and
                maintains consistency over decades, driving the upper tail of the distribution.</li>
        </ul>

        <p>While these mixture components provide a population-level view, the actual model generates **Individual
            Trajectories**. Each simulated runner follows a unique path defined by their start age, career duration, and
            an age-dependent decline curve. This dual perspective—viewing runners as both members of a class and as
            individuals with unique lifecycles—allows for more realistic lifetime projections.</p>

        <h2>2. The Mathematical Model</h2>

        <p>To move from concept to calculation, we use a <strong>Hierarchical Bayesian Framework</strong>. We model the
            individual annual volume $V$ as a Log-Normal random variable, conditioned on the latent group assignment $k
            \in \{C, R, D\}$.</p>

        <p>The core philosophy is that "Casual", "Recreational", and "Dedicated" are not arbitrary labels, but distinct
            statistical modes with their own accumulation properties ($k$) and gender-based shifts ($\beta_g$).</p>

        <h3>2.1 Hierarchical Structure</h3>
        <p>The model estimates the log-scale mean $\mu_k$ for each group. We explicitly model a <strong>Gender
                Shift</strong> ($\beta_{gender}$) based on time-use survey data, allowing us to triangulate "Mixed",
            "Male", and "Female" data sources simultaneously.</p>

        <div class="math-block">
            $$ \ln(V_{i}) \sim \mathcal{N}(\mu_{k} + \mathbb{I}_{male} \cdot \beta_{gender}, \sigma_k^2) $$
        </div>

        <p>Where $\mu_k$ is the female baseline for group $k$, and $\beta_{gender}$ represents the log-scale multiplier
            for male volume.</p>

        <h3>2.2 Bayesian Priors</h3>
        <p>We solve for these parameters using <strong>PyMC</strong> (Probabilistic Programming). The following priors
            serve as the "initial guess" before seeing the data:</p>

        <div class="math-block" style="text-align: left; padding-left: 2rem;">
            \begin{aligned}
            \text{Gender Shift:} & \quad \beta_{gender} \sim \mathcal{N}(\ln(1.52), 0.1) \quad (\text{Source: <a
                href="https://www.bls.gov/news.release/atus.t01.htm" target="_blank">ATUS 2024</a>}) \\
            \text{Casual Base:} & \quad \mu_{casual} \sim \mathcal{N}(\ln(400), 0.8) \\
            \text{Rec Base:} & \quad \mu_{rec} \sim \mathcal{N}(\ln(850), 0.5) \\
            \text{Dedicated Base:} & \quad \mu_{ded} \sim \mathcal{N}(\ln(1800), 0.5) \\
            \text{Variability:} & \quad \sigma_{k} \sim \mathcal{HN}(0.5)
            \end{aligned}
        </div>

        <h3>2.3 Likelihoods (The Data Anchors)</h3>
        <p>The model updates these priors by conditioning on five specific observational anchors (Likelihoods). Each
            anchor constrains the posterior distribution:</p>

        <div class="highlight-box">
            <strong>Observation Map & Data Anchors:</strong>
            <ul style="list-style-type: none; padding-left: 0;">
                <li><strong>1. Casual (Mixed):</strong> $\mu_{casual} + 0.5\beta_{gender} \sim \mathcal{N}(\ln(260))$
                    <br> <small><em>Source: <a
                                href="https://www.prnewswire.com/news-releases/strava-releases-12th-annual-year-in-sport-trend-report-revealing-that-doomscrolling-is-out-movement-is-in-302631107.html"
                                target="_blank">Strava 12th Annual Year in Sport</a> (Gen Z Beginner Median: 5
                            mpw)</em></small>
                </li>
                <li><strong>2. Casual (Older):</strong> $\mu_{casual} + 0.5\beta_{gender} \sim \mathcal{N}(\ln(442))$
                    <br> <small><em>Source: <a
                                href="https://www.prnewswire.com/news-releases/strava-releases-12th-annual-year-in-sport-trend-report-revealing-that-doomscrolling-is-out-movement-is-in-302631107.html"
                                target="_blank">Strava Trend Report</a> (Older Casual Anchor: 8.5 mpw)</em></small>
                </li>
                <li><strong>3. Recreational (Female):</strong> $\mu_{rec} \quad \quad \quad \quad \quad \sim
                    \mathcal{N}(\ln(910))$ <br> <small><em>Source: <a
                                href="https://runrepeat.com/the-state-of-us-marathons-2025" target="_blank">RunRepeat
                                State of US Marathons 2025</a> (Female Rec Avg: 17.5 mpw)</em></small></li>
                <li><strong>4. Dedicated (Male):</strong> $\mu_{ded} + \beta_{gender} \quad \;\; \sim
                    \mathcal{N}(\ln(2080))$ <br> <small><em>Source: <a
                                href="https://runrepeat.com/the-state-of-us-marathons-2025"
                                target="_blank">RunRepeat</a> / <a
                                href="https://www.runningusa.org/product/2024-global-runner-survey/"
                                target="_blank">Running USA</a> (Male Marathoner Anchor: 40 mpw)</em></small></li>
                <li><strong>5. Dedicated (Mixed):</strong> $\mu_{ded} + 0.5\beta_{gender} \sim \mathcal{N}(\ln(1898))$
                    <br> <small><em>Source: <a href="https://www.runningusa.org/product/2024-global-runner-survey/"
                                target="_blank">Running USA 2024
                                Global Runner Survey</a> (Active Survey Participant Avg: 36.5 mpw)</em></small>
                </li>
            </ul>
        </div>

        <p>Additionally, we apply a <strong>"Herron Limit" Potential</strong>: Camille Herron's achievement of reaching
            <strong>100,000 miles by Age 40</strong> (Source: <a href="https://en.wikipedia.org/wiki/Camille_Herron"
                target="_blank">Wikipedia</a>) serves as a Bayesian constraint on the extreme tail of the Dedicated
            distribution. Mathematically, this is implemented as a log-likelihood penalty on the tail parameter:
        </p>
        <div class="math-block">
            $$ \ln L_{Herron} = \text{logCDF}(\mathcal{N}(\mu_{ded, 40}, \sigma_{ded}^2), \ln(100,000)) $$
        </div>
        <p>Where $\mu_{ded, 40}$ is the projected median accumulation for a dedicated runner at age 40.</p>

        <h2>3. The Accumulation function $\mu(t)$</h2>
        <p>Lifetime mileage is not a static number; it is a time-series accumulation. To simulate this, we use a
            <strong>Piecewise Accumulation Function</strong>.
        </p>

        <p>For a simulated individual $i$, the total mileage at age $t$ is the sum of annual volumes
            $V_i(\tau)$:</p>

        <div class="math-block">
            $$ M_i(t) = \sum_{\tau=16}^{t} \mathbb{I}_{active}(\tau) \cdot V_i(\tau) $$
        </div>

        <p>The "Active" status is determined by a generated lifecycle:</p>
        <ul>
            <li><strong>Start Age ($T_{start}$):</strong>
                <ul>
                    <li>Casual/Rec: Unimodal Normal Distribution (~24-28 years old).</li>
                    <li>Dedicated: <strong>Bimodal Distribution</strong> (~Age 16 for student athletes, ~Age 30
                        for adult onset).</li>
                </ul>
            </li>
            <li><strong>Duration ($\Delta_{active}$):</strong> Modeled as a Gamma Distribution. Dedicated
                runners have a mean duration of ~30 years, while Casual runners average ~10 years.</li>
            <li><strong>Intermittency ($p_{active}$):</strong> A Bernoulli coin flip each year to determine if
                the runner was active that specific year.</li>
            <li><strong>Age-Dependent Decline:</strong> We apply a gradual decline curve after Age 45 (~1.5%
                annually), reflecting the physiological boundaries of high-volume running.</li>
        </ul>

        <h2>4. Visualizing the Results</h2>

        <h3>1. The Probability Density (PDF)</h3>
        <figure>
            <img src="output_file_pdf_final.png" alt="Distribution of Lifetime Miles for Runners at Age 60">
            <figcaption>Figure 1: The "Valley of Inconsistency" at Age 60. The distribution is strongly bimodal.
                The
                Casual curve (green) peaks at ~<span id="fig1-casual">2,500</span> miles, while the Dedicated
                curve
                (red) centers on <span id="fig1-ded">58,000</span> miles. Intermediate volumes are statistically
                rare.
            </figcaption>
        </figure>

        <h3>2. The Cumulative Distribution (CDF)</h3>
        <figure>
            <img src="output_file_cdf_final.png" alt="CDF of Lifetime Miles Run by Age">
            <figcaption>Figure 2: Percentile rankings by age. This "S-Curve" shows the massive gap required to
                reach the
                top percentiles.
                The flat region at the bottom represents the non-runner majority.
                As we move up the y-axis (percentiles), the mileage requirement jumps exponentially.
                To reach the top 1% (Dedicated/Elite) at Age 70, you need nearly 90,000 miles—equivalent to
                running
                around
                the Earth 3.5 times.</figcaption>
        </figure>

        <h3>3. Median Trajectories</h3>
        <figure>
            <img src="output_file_medians_final.png" alt="Median Lifetime Miles by Age for Each Group">
            <figcaption>Figure 3: Median Accumulated Volume by Group. This plot reveals how the tribes diverge
                over time.
                Casual runners (Green) plateau early as they age out of the sport or maintain very low volume.
                Dedicated runners (Red) maintain a linear trajectory, stacking consistent decades of volume.
                The Recreational group (Yellow) sits in the middle, representing the committed hobbyist.
            </figcaption>
        </figure>

        <h3>4. Consistency of Habit</h3>
        <figure>
            <img src="output_file_consistency.png"
                alt="Distribution of Consistency Ratios (Active Years / Career Duration)">
            <figcaption>Figure 4: Intermittency vs Consistency. The Casual distribution (Green) is broad,
                showing that
                many casual runners have significant "gap years". The Dedicated distribution (Red) is clustered
                tightly
                at 1.0 (100% active years), illustrating that consistency is the defining trait of the group.
            </figcaption>
        </figure>

        <p><strong>Key Insight:</strong> The difference between limits is not pace, but persistence. A Dedicated
            runner
            averaging 10-minute miles will eventually build a statistical tower of volume that dwarfs a faster
            runner
            who quits after five years.</p>

        <h2>5. Inside the Black Box: Model Mechanics</h2>
        <p>To demystify how the model builds these projections, we can peek under the hood at the three internal
            drivers:</p>

        <h3>1. The "Base Engine": Annual Inputs</h3>
        <figure>
            <img src="output_file_annual_dist.png" alt="Annual Volume Distributions">
            <figcaption>Figure 5: The Annual "Brick" distribution. Before accumulation, these are the
                probabilities of annual volume. Casual runners center at ~450 miles/year, while Dedicated
                runners are nearly <strong>5x higher</strong> at ~2,200 miles/year.</figcaption>
        </figure>

        <h3>2. The "Career Arc": Lifecycles</h3>
        <figure>
            <img src="output_file_gantt.png" alt="Career Gantt Chart of 50 Sample Runners">
            <figcaption>Figure 6: Lifecycle Gantt Chart (Sample of 50 Active Runners). The horizontal bars
                represent the active career of a runner. Notice the "Casual" (Green) runners often have short,
                5-10 year careers, while "Dedicated" (Red) runners maintain the habit for decades.</figcaption>
        </figure>

        <h3>3. The "Persistence Multiplier"</h3>
        <figure>
            <img src="output_file_scatter.png" alt="Scatter Plot of Active Years vs Total Miles">
            <figcaption>Figure 7: Persistence vs Volume. Each dot is a simulated life. The relationship is
                remarkably linear. The "Dedicated" cluster (Red) isn't just higher because they run more per
                day, but because they run for more <em>years</em>.</figcaption>
        </figure>

        <h3>4. Individual Lifecycles (Spaghetti Plot)</h3>
        <figure>
            <img src="output_file_spaghetti.png" alt="Spaghetti Plot of Individual Trajectories">
            <figcaption>Figure 8: Individual Lifecycles. These paths show the actual accumulation for a sample
                of 100 runners. While the class medians (bold lines) show the general trend, the individual
                "spaghetti" lines reveal the variance in start ages and consistency that drives the final
                distribution.</figcaption>
        </figure>

        <h2>6. Model Calibration & Diagnostics</h2>
        <p>A statistical model is only as good as its ability to replicate the observed data. To verify the "goodness of
            fit" for this Bayesian approach, we use two standard diagnostics: <strong>Posterior Predictive Checks
                (PPC)</strong> and <strong>Parameter Forest Plots</strong>.</p>

        <h3>1. Posterior Predictive Check (PPC)</h3>
        <figure>
            <img src="output_file_diag_ppc.png" alt="Posterior Predictive Check">
            <figcaption>Figure 9: Posterior Predictive Check. The black line represents the observed data anchors
                (log-scale), and the blue lines are 10,000 samples drawn from the model's posterior. The tight overlap
                indicates that our model has successfully captured the underlying structure of the data it was trained
                on.</figcaption>
        </figure>

        <h3>2. Parameter Forest Plot</h3>
        <figure>
            <img src="output_file_diag_forest.png" alt="Parameter Forest Plot">
            <figcaption>Figure 10: Parameter Forest Plot. This chart shows the 94% High Density Intervals (HDI) for the
                core latent variables. The narrow ranges for $\beta_{gender}$ and the $\mu$ base values indicate high
                confidence in our estimates given the provided data anchors.</figcaption>
        </figure>

        <h2>7. Interactive Calculators</h2>

        <p>Based on the fitted parameters from the simulation (Casual $\approx$ 450 miles/yr, Dedicated
            $\approx$ 2,200
            miles/yr), I have built these calculators to help you estimate your own horizon.</p>

        <div class="widget-section">
            <h3>1. Lifetime Estimator</h3>
            <div class="calculator">
                <h3>Estimator: How many miles have you run?</h3>
                <p style="font-size: 0.9rem; color: #64748b; margin-bottom: 1.5rem;">Sum your active years
                    below. Any years not accounted for are treated as "Non-Runner" years (0 miles).</p>
                <div class="input-group">
                    <label>Gender Shift:</label>
                    <select id="estGender"
                        style="width: 100%; padding: 1rem; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 1.1rem; background: white;"
                        onchange="calculateTotalMiles()">
                        <option value="mixed">Mixed / Neutral</option>
                        <option value="female">Female</option>
                        <option value="male">Male</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Years as Casual Runner (~5-10 mpw):</label>
                    <input type="number" id="casualYears" placeholder="e.g. 5" oninput="calculateTotalMiles()">
                </div>
                <div class="input-group">
                    <label>Years as Recreational Runner (~15-25 mpw):</label>
                    <input type="number" id="recYears" placeholder="e.g. 10" oninput="calculateTotalMiles()">
                </div>
                <div class="input-group">
                    <label>Years as Dedicated Runner (~40+ mpw):</label>
                    <input type="number" id="dedYears" placeholder="e.g. 2" oninput="calculateTotalMiles()">
                </div>
                <div class="result" id="estResult">0 Miles</div>
            </div>
        </div>

        <div class="widget-section">
            <h3>2. Global Percentile Rank</h3>
            <p>Compare your lifetime total against the entire global population for your age group,
                <strong>including the ~60% of people who are non-runners</strong>.
            </p>

            <div class="widget-grid">
                <div>
                    <label for="userAge">Current Age</label>
                    <span class="helper-text">Between 16 and 80</span>
                    <input type="number" id="userAge" placeholder="30" min="16" max="80">
                </div>
                <div>
                    <label for="userGender">Gender</label>
                    <span class="helper-text">Adjusts baseline volume</span>
                    <select id="userGender"
                        style="width: 100%; padding: 1rem; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 1.1rem; background: white;">
                        <option value="mixed">Mixed / Neutral</option>
                        <option value="female">Female</option>
                        <option value="male">Male</option>
                    </select>
                </div>
                <div>
                    <label for="userMiles">Total Lifetime Miles</label>
                    <span class="helper-text">Your estimated total</span>
                    <input type="number" id="userMiles" placeholder="1000" min="0">
                </div>
            </div>
            <button onclick="calculatePercentile()">Calculate Percentile</button>
            <div id="percResult" class="result-display">-- th Percentile</div>
            <p id="percContext" style="text-align:center; font-size:1rem; color:#6b7280; margin-top:1rem;"></p>
        </div>

        <h2>8. Conclusion</h2>

        <p>The difference between the Casual and Dedicated outcomes is driven less by pace than by persistence.
            A
            Dedicated runner averaging 10-minute miles will eventually accumulate a total volume that dwarfs a
            faster
            runner with lower consistency.</p>

        <p>While daily metrics are useful for training, the "Long Run" perspective emphasizes the compounding
            nature of the activity. Longevity and consistency are not just adjuncts to performance; they are the
            primary determinants of total lifetime output.</p>

        <h2>9. Data Sources</h2>
        <ul style="font-size: 0.95rem; color: #475569;">
            <li><strong>Bureau of Labor Statistics:</strong> <a href="https://www.bls.gov/news.release/atus.t01.htm"
                    target="_blank">American Time Use
                    Survey (Table 1, 2024 Results)</a></li>
            <li><strong>Strava:</strong> <a
                    href="https://www.prnewswire.com/news-releases/strava-releases-12th-annual-year-in-sport-trend-report-revealing-that-doomscrolling-is-out-movement-is-in-302631107.html"
                    target="_blank">12th Annual Year in Sport Trend Report (Dec 2025)</a></li>
            <li><strong>RunRepeat:</strong> <a href="https://runrepeat.com/the-state-of-us-marathons-2025"
                    target="_blank">The State of US Marathons 2025</a></li>
            <li><strong>Running USA:</strong> <a href="https://www.runningusa.org/product/2024-global-runner-survey/"
                    target="_blank">2024
                    Global Runner Survey</a></li>
            <li><strong>Wikipedia:</strong> <a href="https://en.wikipedia.org/wiki/Camille_Herron"
                    target="_blank">Camille Herron (Lifetime Mileage Records)</a></li>
        </ul>

    </main>

    <script>
        // --- JS LOGIC FOR CALCULATORS ---

        // [DATA_INJECTION_START]
        const WEIGHTS = {"non": 0.6, "casual": 0.25, "rec": 0.1, "ded": 0.05};
        const BETA_GENDER = 0.4078;
        const modelData = {
            "16": {
                        "c": [
                                    377,
                                    149
                        ],
                        "r": [
                                    1127,
                                    435
                        ],
                        "d": [
                                    1838,
                                    340
                        ]
                    },
            "20": {
                        "c": [
                                    698,
                                    433
                        ],
                        "r": [
                                    3005,
                                    1724
                        ],
                        "d": [
                                    6944,
                                    2349
                        ]
                    },
            "30": {
                        "c": [
                                    1148,
                                    800
                        ],
                        "r": [
                                    7260,
                                    4098
                        ],
                        "d": [
                                    20272,
                                    7622
                        ]
                    },
            "40": {
                        "c": [
                                    1774,
                                    1133
                        ],
                        "r": [
                                    15408,
                                    5137
                        ],
                        "d": [
                                    30950,
                                    12009
                        ]
                    },
            "50": {
                        "c": [
                                    2186,
                                    1455
                        ],
                        "r": [
                                    22787,
                                    5936
                        ],
                        "d": [
                                    41801,
                                    12142
                        ]
                    },
            "60": {
                        "c": [
                                    2284,
                                    1602
                        ],
                        "r": [
                                    26802,
                                    7571
                        ],
                        "d": [
                                    47025,
                                    13129
                        ]
                    },
            "70": {
                        "c": [
                                    2299,
                                    1637
                        ],
                        "r": [
                                    28307,
                                    8808
                        ],
                        "d": [
                                    48752,
                                    14184
                        ]
                    },
            "80": {
                        "c": [
                                    2301,
                                    1645
                        ],
                        "r": [
                                    28716,
                                    9369
                        ],
                        "d": [
                                    49194,
                                    14649
                        ]
                    }
        };
        const FIG_STATS = {
            "age60": {
                        "casualMode": 1081,
                        "recreationalMode": 28468,
                        "dedicatedMode": 43843
                    }
        };
        // [DATA_INJECTION_END]

        function onPageLoad() {
            // Update Figure 1 Caption with Exact Stats
            document.getElementById('fig1-casual').innerText = FIG_STATS.age60.casualMode.toLocaleString();
            document.getElementById('fig1-ded').innerText = FIG_STATS.age60.dedMode.toLocaleString();
        }
        window.onload = onPageLoad;

        // Math Helpers: Numerical Approximation of the Error Function (A&S 7.1.26)
        function erf(x) {
            // save the sign of x
            var sign = (x >= 0) ? 1 : -1;
            x = Math.abs(x);

            // constants
            var a1 = 0.254829592;
            var a2 = -0.284496736;
            var a3 = 1.421413741;
            var a4 = -1.453152027;
            var a5 = 1.061405429;
            var p = 0.3275911;

            // A&S formula 7.1.26
            var t = 1.0 / (1.0 + p * x);
            var y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);

            return sign * y;
        }

        function normCDF(x, mean, std) {
            if (std === 0) return x < mean ? 0 : 1;
            return 0.5 * (1 + erf((x - mean) / (std * Math.sqrt(2))));
        }

        function logNormCDF(x, mean_linear, std_linear) {
            if (x <= 0) return 0;
            // Convert linear mean/std to log-space mu/sigma
            const v = Math.pow(std_linear, 2);
            const m2 = Math.pow(mean_linear, 2);
            const mu_log = Math.log(m2 / Math.sqrt(v + m2));
            const sigma_log = Math.sqrt(Math.log(1 + (v / m2)));

            return normCDF(Math.log(x), mu_log, sigma_log);
        }

        function lerp(start, end, t) {
            return start * (1 - t) + end * t;
        }

        function getParams(age) {
            age = Math.max(16, Math.min(80, age));
            const brackets = [16, 20, 30, 40, 50, 60, 70, 80];
            let lower = 16, upper = 80;

            for (let i = 0; i < brackets.length - 1; i++) {
                if (age >= brackets[i] && age <= brackets[i + 1]) {
                    lower = brackets[i];
                    upper = brackets[i + 1];
                    break;
                }
            }

            if (lower === upper) return modelData[lower];

            const t = (age - lower) / (upper - lower);
            return {
                c: [lerp(modelData[lower].c[0], modelData[upper].c[0], t), lerp(modelData[lower].c[1], modelData[upper].c[1], t)],
                r: [lerp(modelData[lower].r[0], modelData[upper].r[0], t), lerp(modelData[lower].r[1], modelData[upper].r[1], t)],
                d: [lerp(modelData[lower].d[0], modelData[upper].d[0], t), lerp(modelData[lower].d[1], modelData[upper].d[1], t)]
            };
        }

        // Logic
        function calculateTotalMiles() {
            const gender = document.getElementById('estGender').value;
            const c = parseFloat(document.getElementById('casualYears').value) || 0;
            const r = parseFloat(document.getElementById('recYears').value) || 0;
            const d = parseFloat(document.getElementById('dedYears').value) || 0;

            // Current Sim "Mixed" Averages approx:
            // Casual: ~250/yr (5 mpw) -> Adjusted for gender
            // Rec: ~750/yr (15 mpw)
            // Dedicated: ~2100/yr (40 mpw)

            let mult = 1.0;
            if (gender === 'female') mult = Math.exp(-0.5 * BETA_GENDER); // ~0.82
            if (gender === 'male') mult = Math.exp(0.5 * BETA_GENDER);   // ~1.22

            // Base Rates (Mixed)
            const RATE_C = 250;
            const RATE_R = 750;
            const RATE_D = 2100;

            const total = (c * RATE_C * mult) + (r * RATE_R * mult) + (d * RATE_D * mult);

            const el = document.getElementById('estResult');
            el.innerText = total.toLocaleString(undefined, { maximumFractionDigits: 0 }) + " Miles";
        }

        function calculatePercentile() {
            const age = parseFloat(document.getElementById('userAge').value);
            const miles = parseFloat(document.getElementById('userMiles').value);

            if (!age || isNaN(miles)) return;

            const p = getParams(age);
            const gender = document.getElementById('userGender').value;

            // Adjust Means based on Gender
            // Model Data is "Mixed" (Base + 0.5 Beta)
            // Linear Mean Multiplier: 
            // Male Multiplier = exp(0.5 * BETA_GENDER)
            // Female Multiplier = exp(-0.5 * BETA_GENDER)
            let mult = 1.0;
            if (gender === 'female') mult = Math.exp(-0.5 * BETA_GENDER);
            if (gender === 'male') mult = Math.exp(0.5 * BETA_GENDER);

            const adj_p = {
                c: [p.c[0] * mult, p.c[1] * mult],
                r: [p.r[0] * mult, p.r[1] * mult],
                d: [p.d[0] * mult, p.d[1] * mult]
            };

            // Calculate CDF for each group
            const cdf_n = (miles > 0) ? 1.0 : 0.0;
            const cdf_c = logNormCDF(miles, adj_p.c[0], adj_p.c[1]);
            const cdf_r = logNormCDF(miles, adj_p.r[0], adj_p.r[1]);
            const cdf_d = logNormCDF(miles, adj_p.d[0], adj_p.d[1]);

            // Weighted Sum (The Mixture)
            const totalProb = (WEIGHTS.non * cdf_n) + (WEIGHTS.casual * cdf_c) + (WEIGHTS.rec * cdf_r) + (WEIGHTS.ded * cdf_d);
            const perc = (totalProb * 100);

            let percString = perc.toFixed(1);
            if (perc > 99.9) percString = perc.toFixed(4);

            document.getElementById('percResult').innerText = percString + "th Percentile";

            let ctx = "";
            if (perc < 60) ctx = "You are in the Non-Runner range (The Majority).";
            else if (perc < 85) ctx = "You are in the Casual Runner tier.";
            else if (perc < 95) ctx = "You are in the Recreational Runner tier, consistent and dedicated.";
            else ctx = "You are in the Dedicated Runner tier, truly an outlier.";

            document.getElementById('percContext').innerText = ctx;
        }
    </script>

</body>

</html>